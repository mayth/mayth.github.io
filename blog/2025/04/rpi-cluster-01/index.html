<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.149.0"><title>Raspberry Piã§Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€ï¼ˆãã®3: k8sã‚¯ãƒ©ã‚¹ã‚¿æ§‹ç¯‰ç·¨ï¼‰ &#183; Hello, (forgotten) world â˜‚</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=https://aquarite.info/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://aquarite.info/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=https://aquarite.info/css/blackburn.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel=stylesheet type=text/css><link rel="shortcut icon" href=https://aquarite.info/img/favicon.ico type=image/x-icon><meta property="og:url" content="https://aquarite.info/blog/2025/04/rpi-cluster-01/"><meta property="og:site_name" content="Hello, (forgotten) world â˜‚"><meta property="og:title" content="Raspberry Piã§Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€ï¼ˆãã®3: k8sã‚¯ãƒ©ã‚¹ã‚¿æ§‹ç¯‰ç·¨ï¼‰"><meta property="og:description" content="ãã®2ãŒ2022å¹´ã®å¤ãªã®ã§ã‚‚ã†3å¹´è¿‘ãæ”¾ç½®ã—ã¦ã„ãŸRaspberryPiã§k8sã€ãªã‚“ã¨ãªããã‚ãã‚æ‰‹ã‚’ä»˜ã‘ã‚‹ã‹ã¨æ€ã£ãŸã®ã§å†é–‹ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚
ãªã‚“ã§æ”¾ç½®ã—ãŸã‹ã¨ã„ã†ã¨ã€kubeadm initã¯æ­£å¸¸ã«çµ‚äº†ã™ã‚‹ã‚‚ã®ã®apiserverãŒç„¡é™å†èµ·å‹•ç·¨ã«çªå…¥ã—ã¦æ­£å¸¸ã«ç¨¼åƒã—ãªãã¦å¿ƒãŒæŠ˜ã‚ŒãŸã¨ã„ã†ã®ãŒã‚ã‚‹ã€‚"><meta property="og:locale" content="ja_jp"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-06T18:41:00+09:00"><meta property="article:modified_time" content="2025-04-06T18:41:00+09:00"><meta property="article:tag" content="Tech"><meta property="article:tag" content="Raspberry Pi"><meta property="og:image" content="https://aquarite.info/images/cover.png"></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=https://aquarite.info/>aquarite.info</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=https://aquarite.info/><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://aquarite.info/about/><i class='fa fa-user fa-fw'></i>About</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small>&copy; 2021 Mei Akizuru. All rights reserved.</small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div></div></div><div id=main><div class=header><h1>Raspberry Piã§Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’çµ„ã‚€ï¼ˆãã®3: k8sã‚¯ãƒ©ã‚¹ã‚¿æ§‹ç¯‰ç·¨ï¼‰</h1><h2></h2></div><div class=content><p>ãã®2ãŒ2022å¹´ã®å¤ãªã®ã§ã‚‚ã†3å¹´è¿‘ãæ”¾ç½®ã—ã¦ã„ãŸRaspberryPiã§k8sã€ãªã‚“ã¨ãªããã‚ãã‚æ‰‹ã‚’ä»˜ã‘ã‚‹ã‹ã¨æ€ã£ãŸã®ã§å†é–‹ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚</p><p>ãªã‚“ã§æ”¾ç½®ã—ãŸã‹ã¨ã„ã†ã¨ã€<code>kubeadm init</code>ã¯æ­£å¸¸ã«çµ‚äº†ã™ã‚‹ã‚‚ã®ã®apiserverãŒç„¡é™å†èµ·å‹•ç·¨ã«çªå…¥ã—ã¦æ­£å¸¸ã«ç¨¼åƒã—ãªãã¦å¿ƒãŒæŠ˜ã‚ŒãŸã¨ã„ã†ã®ãŒã‚ã‚‹ã€‚</p><blockquote class=twitter-tweet><p lang=ja dir=ltr>ä¸€ç”Ÿkubeadm initãŒæˆåŠŸã—ãªã„ã€ã„ã‚„æˆåŠŸã™ã‚‹ã‚“ã ã‘ã©ãã®å¾Œapiserverã‚„ã‚‰schedulerã‚„ã‚‰ãŒå‹æ‰‹ã«å†èµ·å‹•ã—ã¾ãã£ã¦ã¦ä½¿ã„ç‰©ã«ãªã‚‰ãªã„ã€ãªã‚“ã ã“ã‚Œâ€¦â€¦</p>&mdash; ç§‹å¼¦ã‚ã„â˜‚ (@maytheplic) <a href="https://twitter.com/maytheplic/status/1543970689610563585?ref_src=twsrc%5Etfw">July 4, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>çµå±€åŸå› ã‚’è¿½åŠã§ããªãã¦ãŠæ‰‹ä¸Šã’ã«ãªã£ãŸã‚ã‘ã ãŒã€ãã‚Œã‹ã‚‰ã¾ã3å¹´ã‚‚çµŒã¦ã°ä½•ã‹ã—ã‚‰å¤‰åŒ–ãŒã‚ã‚‹ã ã‚ã†ã¨æ€ã£ã¦å†æŒ‘æˆ¦ã—ã¦ã¿ã‚‹ã€‚</p><p>ãªãŠã€ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã¯ã»ã¼å¤‰ã‚ã‚‰ãªã„ãŒã€Raspberry Pi OSã¯ãƒ™ãƒ¼ã‚¹ã«ãªã‚‹Debianã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸ŠãŒã£ã¦Bullseyeã‹ã‚‰Bookwormã«ãªã£ã¦ã„ã‚‹ã€‚</p><h2 id=ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ</h2><p>æˆ‘ãŒå®¶ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯<code>192.168.39.0/24</code>ãŒåŸºæœ¬ã«ãªã£ã¦ã„ã‚‹ï¼ˆ<code>39</code>ã¯ä¹±æ•°ã§æŒ¯ã£ãŸã ã‘ï¼‰ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãŠã‚ˆã³DNSã‚µãƒ¼ãƒãƒ¼ã¯<code>192.168.39.1</code>ã§ã‚ã‚‹ã€‚</p><p>å„ãƒãƒ¼ãƒ‰ã¯<code>thistle-[0-2]</code>ã¨ã„ã†ãƒ›ã‚¹ãƒˆåãŒæŒ¯ã‚‰ã‚Œã¦ãŠã‚Šã€<code>thistle-[0-2].intra.aquarite.info</code>ã§åå‰è§£æ±ºãŒã§ãã‚‹ã€‚ãªãŠã€ã“ã‚Œã¯å®…å†…ã®DNSã‚µãƒ¼ãƒãƒ¼ã«è¨­å®šã‚’ä»•è¾¼ã‚“ã§ã‚ã‚‹ã ã‘ã§ã€å½“ç„¶å¤–éƒ¨ã‹ <code>intra.aquarite.info</code>ã®åå‰è§£æ±ºã¯ã§ããªã„ã€‚ã¾ãŸã€<code>thistle-[0-2]</code>ã¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å›ºå®šã—ã¦ã„ã¦ã€<code>thistle-0</code>ã‹ã‚‰é †ã«<code>192.168.39.[20-22]</code>ã¨ãªã£ã¦ã„ã‚‹ã€‚</p><p>Kubernetesã®ãŸã‚ã«ã¯<code>10.0.0.0/8</code>ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã€‚</p><h2 id=ã‚·ã‚¹ãƒ†ãƒ ã®æº–å‚™>ã‚·ã‚¹ãƒ†ãƒ ã®æº–å‚™</h2><p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚¹ãƒ¯ãƒƒãƒ—ãŒæœ‰åŠ¹ã ãŒã€kubeletã¯ã‚¹ãƒ¯ãƒƒãƒ—ãŒæœ‰åŠ¹ãªã¾ã¾ã§ã¯èµ·å‹•ã§ããªã„ã€‚ã‚¹ãƒ¯ãƒƒãƒ—ãŒã‚ã£ã¦ã‚‚èµ·å‹•ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ã‹ã€ã‚¹ãƒ¯ãƒƒãƒ—ã‚’ç„¡åŠ¹ã«ã™ã‚Œã°ã‚ˆã„ã€‚ä»Šå›ã¯ã‚¹ãƒ¯ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã€ç„¡åŠ¹ã«ã—ã¦ãŠãã€‚</p><p>ã¾ãšã¯çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã€‚<code>free</code>ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Swapã®totalãŒ<code>511Mi</code>ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ã‚¹ãƒ¯ãƒƒãƒ—ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚</p><pre tabindex=0><code>$ free -h
               total        used        free      shared  buff/cache   available
Mem:           7.6Gi       178Mi       7.3Gi       1.1Mi       249Mi       7.5Gi
Swap:          511Mi          0B       511Mi
</code></pre><p>ã‚¹ãƒ¯ãƒƒãƒ—ç„¡åŠ¹åŒ–ã¨ã€ã‚¹ãƒ¯ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹ <code>dphys-swapfile</code> ã®åœæ­¢ã‚’è¡Œã†ã€‚</p><pre tabindex=0><code>$ sudo swapoff --all
$ sudo systemctl stop dphys-swapfile.service
$ sudo systemctl disable dphys-swapfile.service
</code></pre><p>IPv4ã®IPãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚</p><pre tabindex=0><code>$ sudo sysctl -w net.ipv4.ip_forward=1
</code></pre><p>æ¬¡ã«memory cgroupã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚<code>/boot/firmware/cmdline.txt</code> ã‚’é–‹ãã€è¡Œæœ«ã« <code>cgroup_enable=memory cgroup_memory=1</code> ã‚’è¿½è¨˜ã™ã‚‹ã€‚</p><pre tabindex=0><code>$ cat /boot/firmware/cmdline.txt
console=serial0,115200 console=tty1 root=PARTUUID=99a9f0e9-02 rootfstype=ext4 fsck.repair=yes rootwait cgroup_enable=memory cgroup_memory=1
</code></pre><p>æœ€å¾Œã«<code>br_netfilter</code>ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚èµ·å‹•æ™‚ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«<code>/etc/modules-load.d/</code>ä»¥ä¸‹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚</p><pre tabindex=0><code>$ echo br_netfilter | sudo tee /etc/modules-load.d/br_netfilter.conf
</code></pre><p>ã“ã“ã§ä¸€å›å†èµ·å‹•ã™ã‚‹ã€‚</p><p>ãªãŠã€cgroupsã®çŠ¶æ…‹ã¯ <code>/proc/cgroups</code> ã§ç¢ºèªã§ãã‚‹ã€‚ç„¡åŠ¹ã®çŠ¶æ…‹ã ã¨ã€æ¬¡ã®ã‚ˆã†ã« <code>memory</code> ã®è¡Œã® <code>enabled</code> ãŒ <code>0</code> ã«ãªã£ã¦ã„ã‚‹ã€‚</p><pre tabindex=0><code>$ cat /proc/cgroups
#subsys_name	hierarchy	num_cgroups	enabled
cpuset	0	38	1
cpu	0	38	1
cpuacct	0	38	1
blkio	0	38	1
memory	0	38	0
devices	0	38	1
freezer	0	38	1
net_cls	0	38	1
perf_event	0	38	1
net_prio	0	38	1
pids	0	38	1
</code></pre><p>ä¸Šè¨˜ã®é€šã‚Šç·¨é›†ã—ã¦å†èµ·å‹•ã™ã‚‹ã¨ã€<code>1</code> ã«å¤‰ã‚ã£ã¦ã„ã‚‹ã€‚</p><pre tabindex=0><code>$ cat /proc/cgroups
#subsys_name	hierarchy	num_cgroups	enabled
cpuset	0	69	1
cpu	0	69	1
cpuacct	0	69	1
blkio	0	69	1
memory	0	69	1
devices	0	69	1
freezer	0	69	1
net_cls	0	69	1
perf_event	0	69	1
net_prio	0	69	1
pids	0	69	1
</code></pre><h2 id=ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®æº–å‚™>ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®æº–å‚™</h2><p>ä»Šå›ã¯CRI-Oã‚’æ¡ç”¨ã™ã‚‹ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯v1.32ç³»ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã¨ã—ã€æ¬¡ã®é€šã‚Šç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãŠãã€‚</p><pre tabindex=0><code>KUBERNETES_VERSION=v1.32
CRIO_VERSION=v1.32
</code></pre><p><a href=https://github.com/cri-o/packaging/blob/main/README.md#distributions-using-deb-packages>https://github.com/cri-o/packaging/blob/main/README.md#distributions-using-deb-packages</a> ã«å¾“ã£ã¦ãƒªãƒã‚¸ãƒˆãƒªã®è¿½åŠ ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã†ã€‚</p><pre tabindex=0><code>$ curl -fsSL https://pkgs.k8s.io/core:/stable:/$KUBERNETES_VERSION/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
$ echo &#34;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/$KUBERNETES_VERSION/deb/ /&#34; | sudo tee -a /etc/apt/sources.list.d/kubernetes.list

$ curl -fsSL https://download.opensuse.org/repositories/isv:/cri-o:/stable:/$CRIO_VERSION/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/cri-o-apt-keyring.gpg
$ echo &#34;deb [signed-by=/etc/apt/keyrings/cri-o-apt-keyring.gpg] https://download.opensuse.org/repositories/isv:/cri-o:/stable:/$CRIO_VERSION/deb/ /&#34; | sudo tee /etc/apt/sources.list.d/cri-o.list

$ sudo apt update
$ sudo apt install cri-o kubelet kubeadm kubectl
$ sudo systemctl enable --now crio.service
$ sudo systemctl enable --now kubelet
</code></pre><p><code>kubeadm init</code> ã§ã‚¯ãƒ©ã‚¹ã‚¿ã‚’åˆæœŸåŒ–ã™ã‚‹ã€‚</p><pre tabindex=0><code>$ sudo kubeadm init --control-plane-endpoint=thistle-0.intra.aquarite.info --pod-network-cidr=10.0.0.0/8
[init] Using Kubernetes version: v1.32.3
[preflight] Running pre-flight checks
	[WARNING SystemVerification]: missing optional cgroups: hugetlb
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action beforehand using &#39;kubeadm config images pull&#39;
[certs] Using certificateDir folder &#34;/etc/kubernetes/pki&#34;
[certs] Generating &#34;ca&#34; certificate and key
[certs] Generating &#34;apiserver&#34; certificate and key
[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local thistle-0 thistle-0.intra.aquarite.info] and IPs [10.96.0.1 192.168.39.20]
[certs] Generating &#34;apiserver-kubelet-client&#34; certificate and key
[certs] Generating &#34;front-proxy-ca&#34; certificate and key
[certs] Generating &#34;front-proxy-client&#34; certificate and key
[certs] Generating &#34;etcd/ca&#34; certificate and key
[certs] Generating &#34;etcd/server&#34; certificate and key
[certs] etcd/server serving cert is signed for DNS names [localhost thistle-0] and IPs [192.168.39.20 127.0.0.1 ::1]
[certs] Generating &#34;etcd/peer&#34; certificate and key
[certs] etcd/peer serving cert is signed for DNS names [localhost thistle-0] and IPs [192.168.39.20 127.0.0.1 ::1]
[certs] Generating &#34;etcd/healthcheck-client&#34; certificate and key
[certs] Generating &#34;apiserver-etcd-client&#34; certificate and key
[certs] Generating &#34;sa&#34; key and public key
[kubeconfig] Using kubeconfig folder &#34;/etc/kubernetes&#34;
[kubeconfig] Writing &#34;admin.conf&#34; kubeconfig file
[kubeconfig] Writing &#34;super-admin.conf&#34; kubeconfig file
[kubeconfig] Writing &#34;kubelet.conf&#34; kubeconfig file
[kubeconfig] Writing &#34;controller-manager.conf&#34; kubeconfig file
[kubeconfig] Writing &#34;scheduler.conf&#34; kubeconfig file
[etcd] Creating static Pod manifest for local etcd in &#34;/etc/kubernetes/manifests&#34;
[control-plane] Using manifest folder &#34;/etc/kubernetes/manifests&#34;
[control-plane] Creating static Pod manifest for &#34;kube-apiserver&#34;
[control-plane] Creating static Pod manifest for &#34;kube-controller-manager&#34;
[control-plane] Creating static Pod manifest for &#34;kube-scheduler&#34;
[kubelet-start] Writing kubelet environment file with flags to file &#34;/var/lib/kubelet/kubeadm-flags.env&#34;
[kubelet-start] Writing kubelet configuration to file &#34;/var/lib/kubelet/config.yaml&#34;
[kubelet-start] Starting the kubelet
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &#34;/etc/kubernetes/manifests&#34;
[kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s
[kubelet-check] The kubelet is healthy after 2.001340198s
[api-check] Waiting for a healthy API server. This can take up to 4m0s
[api-check] The API server is healthy after 9.003387504s
[upload-config] Storing the configuration used in ConfigMap &#34;kubeadm-config&#34; in the &#34;kube-system&#34; Namespace
[kubelet] Creating a ConfigMap &#34;kubelet-config&#34; in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Skipping phase. Please see --upload-certs
[mark-control-plane] Marking the node thistle-0 as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
[mark-control-plane] Marking the node thistle-0 as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]
[bootstrap-token] Using token: ***
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes
[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the &#34;cluster-info&#34; ConfigMap in the &#34;kube-public&#34; namespace
[kubelet-finalize] Updating &#34;/etc/kubernetes/kubelet.conf&#34; to point to a rotatable kubelet client certificate and key
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run &#34;kubectl apply -f [podnetwork].yaml&#34; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of control-plane nodes by copying certificate authorities
and service account keys on each node and then running the following as root:

  kubeadm join thistle-0.intra.aquarite.info:6443 --token *** \
	--discovery-token-ca-cert-hash sha256:*** \
	--control-plane

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join thistle-0.intra.aquarite.info:6443 --token *** \
	--discovery-token-ca-cert-hash sha256:***
</code></pre><p>â€» ä¸€å¿œãƒˆãƒ¼ã‚¯ãƒ³ã¨ã‹ãƒãƒƒã‚·ãƒ¥ã®ã¨ã“ã‚ã¯æ½°ã—ã¦ã„ã‚‹ã€‚</p><p>æ®‹ã‚Šã®2ãƒãƒ¼ãƒ‰ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ€å¾Œã«è¡¨ç¤ºã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚</p><pre tabindex=0><code>$ sudo kubeadm join thistle-0.intra.aquarite.info:6443 --token *** \
        --discovery-token-ca-cert-hash sha256:***
[preflight] Running pre-flight checks
	[WARNING SystemVerification]: missing optional cgroups: hugetlb
[preflight] Reading configuration from the &#34;kubeadm-config&#34; ConfigMap in namespace &#34;kube-system&#34;...
[preflight] Use &#39;kubeadm init phase upload-config --config your-config.yaml&#39; to re-upload it.
[kubelet-start] Writing kubelet configuration to file &#34;/var/lib/kubelet/config.yaml&#34;
[kubelet-start] Writing kubelet environment file with flags to file &#34;/var/lib/kubelet/kubeadm-flags.env&#34;
[kubelet-start] Starting the kubelet
[kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s
[kubelet-check] The kubelet is healthy after 1.503925623s
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run &#39;kubectl get nodes&#39; on the control-plane to see this node join the cluster.
</code></pre><p>ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãƒ‰ã§ãƒãƒ¼ãƒ‰ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã€‚CNIãŒå…¥ã£ã¦ã„ãªã„ã®ã§å…¨ã¦ã®ãƒãƒ¼ãƒ‰ãŒNotReadyã«ãªã£ã¦ã„ã‚‹ã€‚</p><pre tabindex=0><code> $ kubectl get nodes
NAME        STATUS     ROLES           AGE     VERSION
thistle-0   NotReady   control-plane   4m21s   v1.32.3
thistle-1   NotReady   &lt;none&gt;          2m30s   v1.32.3
thistle-2   NotReady   &lt;none&gt;          2m21s   v1.32.3
</code></pre><h2 id=ciliumã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¤±æ•—>Ciliumã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå¤±æ•—ï¼‰</h2><p>ã¾ãšã¯å…¬å¼ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹ã€‚</p><pre tabindex=0><code>CILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)
CLI_ARCH=amd64
if [ &#34;$(uname -m)&#34; = &#34;aarch64&#34; ]; then CLI_ARCH=arm64; fi
curl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_CLI_VERSION}/cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}
sha256sum --check cilium-linux-${CLI_ARCH}.tar.gz.sha256sum
sudo tar xzvfC cilium-linux-${CLI_ARCH}.tar.gz /usr/local/bin
rm cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}
</code></pre><p>Cilium CLIã‚’ç¢ºèªã™ã‚‹ã€‚</p><pre tabindex=0><code>$ which cilium
/usr/local/bin/cilium
</code></pre><p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚ã“ã®æ™‚ç‚¹ã§ã®æœ€æ–°ç‰ˆã¯1.17.2ã€‚</p><pre tabindex=0><code>$ cilium install --version 1.17.2
â„¹ï¸  Using Cilium version 1.17.2
ğŸ”® Auto-detected cluster name: kubernetes
ğŸ”® Auto-detected kube-proxy has been installed
</code></pre><p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèªã™ã‚‹ã€‚<code>--wait</code>ã‚’ä¸ãˆã‚‹ã¨æ­£å¸¸ãªçŠ¶æ…‹ã«ãªã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—ã™ã‚‹ã€‚</p><pre tabindex=0><code>$ cilium status --wait
    /Â¯Â¯\
 /Â¯Â¯\__/Â¯Â¯\    Cilium:             1 errors, 2 warnings
 \__/Â¯Â¯\__/    Operator:           OK
 /Â¯Â¯\__/Â¯Â¯\    Envoy DaemonSet:    1 errors, 1 warnings
 \__/Â¯Â¯\__/    Hubble Relay:       disabled
    \__/       ClusterMesh:        disabled

DaemonSet              cilium                   Desired: 3, Ready: 1/3, Available: 1/3, Unavailable: 2/3
DaemonSet              cilium-envoy             Desired: 3, Unavailable: 3/3
Deployment             cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1
Containers:            cilium                   Pending: 2, Running: 1
                       cilium-envoy             Pending: 1, Running: 2
                       cilium-operator          Running: 1
...
</code></pre><p>ã—ã°ã‚‰ãå¾…ã¦ã°æ­£å¸¸çµ‚äº†ã™ã‚‹ã¯ãšãŒã€Envoy DaemonSetã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ä¸€å‘ã«çµ‚äº†ã—ãªã„ã€‚ä¸€æ—¦Ctrl-Cã§æ­¢ã‚ã¦ã€ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚ã¾ãšã¯podã®ä¸€è¦§ã‚’è¦‹ã‚‹ã€‚</p><pre tabindex=0><code>$ kubectl -n kube-system get pods
NAME                                READY   STATUS             RESTARTS      AGE
cilium-4kw74                        1/1     Running            0             3m17s
cilium-envoy-jp7xv                  0/1     CrashLoopBackOff   4 (20s ago)   3m17s
cilium-envoy-v6rtr                  0/1     CrashLoopBackOff   4 (18s ago)   3m17s
cilium-envoy-w2fzn                  0/1     CrashLoopBackOff   5 (10s ago)   3m17s
cilium-nw99x                        1/1     Running            0             3m17s
cilium-operator-59944f4b8f-t77mw    1/1     Running            0             3m17s
cilium-pwcfx                        1/1     Running            0             3m17s
coredns-86c5fccbb-2css6             1/1     Running            0             2m17s
coredns-86c5fccbb-ztp94             1/1     Running            0             2m17s
etcd-thistle-0                      1/1     Running            1             9m24s
kube-apiserver-thistle-0            1/1     Running            1             9m24s
kube-controller-manager-thistle-0   1/1     Running            1             9m24s
kube-proxy-ctmwg                    1/1     Running            0             7m29s
kube-proxy-jzcqj                    1/1     Running            0             7m38s
kube-proxy-rc25q                    1/1     Running            0             9m21s
kube-scheduler-thistle-0            1/1     Running            1             9m26s
</code></pre><p><code>cilium-envoy-*</code> ãŒCrashLoopBackOffã«ãªã£ã¦ã„ã‚‹ã€‚<code>jp7xv</code>ã®podã®ãƒ­ã‚°ã‚’è¦‹ã‚‹ã€‚</p><pre tabindex=0><code>$ kubectl -n kube-system logs cilium-envoy-jp7xv
external/com_github_google_tcmalloc/tcmalloc/system-alloc.cc:625] MmapAligned() failed - unable to allocate with tag (hint, size, alignment) - is something limiting address placement? 0x161600000000 1073741824 1073741824 @ 0x557b0bccc4 0x557b0b90e0 0x557b0b89a0 0x557b0981d0 0x557b0b6694 0x557b0b6468 0x557b08d988 0x557afa3c84 0x557afa09a0 0x7f94868614
external/com_github_google_tcmalloc/tcmalloc/arena.cc:58] FATAL ERROR: Out of memory trying to allocate internal tcmalloc data (bytes, object-size); is something preventing mmap from succeeding (sandbox, VSS limitations)? 131072 632 @ 0x557b0bd034 0x557b098260 0x557b0b6694 0x557b0b6468 0x557b08d988 0x557afa3c84 0x557afa09a0 0x7f94868614
</code></pre><p>ã©ã†ã‚‚ãƒ¡ãƒ¢ãƒªã®ç¢ºä¿ã«å¤±æ•—ã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚2è¡Œç›®ã§ã¯Out of memoryã¨è¨€ã£ã¦ã„ã‚‹ã®ã§ã€å¿µã®ãŸã‚ãƒ¡ãƒ¢ãƒªã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ãŒã€ãƒ¡ãƒ¢ãƒªã«ã¯ä½™è£•ãŒã‚ã‚‹ã®ã§åˆ¥ã®åŸå› ã§ã‚ã‚ã†ã¨æ€ã‚ã‚Œã‚‹ã€‚</p><pre tabindex=0><code>$ free -h
               total        used        free      shared  buff/cache   available
Mem:           7.6Gi       878Mi       4.3Gi       3.4Mi       2.6Gi       6.8Gi
Swap:             0B          0B          0B
</code></pre><p>èª¿ã¹ã¦ã¿ã‚‹ã¨ã€ã©ã†ã‚„ã‚‰Envoyã€ã¨ã„ã†ã‹tcmallocã®å•é¡Œã§ã€Raspberry Pi (ARM64)ã§å‹•ä½œã—ãªã„ã‚ˆã†ã ã€‚ã‹ãªã‚Šå‰ã®issueã§ã¯ã‚ã‚‹ãŒã€ã‚³ãƒ¡ãƒ³ãƒˆè‡ªä½“ã¯2024å¹´ã¾ã§ã¤ã„ã¦ã„ã¦çŠ¶æ³ãŒæ”¹å–„ã•ã‚Œã¦ãªã•ãã†ãªé›°å›²æ°—ãŒã‚ã‚‹ã€‚å®Ÿéš›ã“ã†ã—ã¦å•é¡Œã‚’è¸ã‚“ã§ã„ã‚‹ã—â€¦â€¦ã€‚</p><ul><li><a href=https://github.com/envoyproxy/envoy/issues/23339>Envoy 1.17-1.23 unable to start on Raspberry Â· Issue #23339 Â· envoyproxy/envoy</a></li><li><a href=https://github.com/cilium/cilium/issues/17467>Cilium fails to launch on ARM64: Binary cilium-envoy cannot be executed Â· Issue #17467 Â· cilium/cilium</a></li></ul><p>å•é¡Œã‚’å›é¿ã™ã‚‹ã«ã¯ã‚«ãƒ¼ãƒãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¤‰ãˆã¦ãƒ“ãƒ«ãƒ‰ã—ç›´ã™ã‹tcmallocã‚’ãƒ“ãƒ«ãƒ‰ã—ç›´ã™å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã€ã•ã™ãŒã«ãƒ˜ãƒ“ãƒ¼éãã‚‹ã¨ã„ã†ã‹ã€ä»Šå¾Œã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒæ€ ã™ãã‚‹ã®ã§å¤§äººã—ãFlannelã‚’ä½¿ã†ã“ã¨ã«ã—ãŸã€‚ã¨ã„ã†ã‚ã‘ã§Ciliumã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚</p><pre tabindex=0><code>$ cilium uninstall
</code></pre><h2 id=flannelã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«>Flannelã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h2><p>Podãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¯„å›²ã‚’<code>10.0.0.0/8</code>ã«ã—ã¦ã„ã‚‹ã®ã§å°‘ã€…ä¿®æ­£ãŒå¿…è¦ã§ã‚ã‚‹ã€‚ã¾ãšã¯YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚‹ã€‚</p><pre tabindex=0><code>$ curl -LO &#39;https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml&#39;
</code></pre><p>ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦CIDRã®æŒ‡å®šã‚’ç·¨é›†ã™ã‚‹ã€‚</p><pre tabindex=0><code>...
  net-conf.json: |
    {
      &#34;Network&#34;: &#34;10.0.0.0/8&#34;,
      &#34;EnableNFTables&#34;: false,
      &#34;Backend&#34;: {
        &#34;Type&#34;: &#34;vxlan&#34;
      }
    }
...
</code></pre><p>ãã‚Œã‹ã‚‰<code>kubectl apply</code>ã‚’è¡Œã†ã€‚</p><pre tabindex=0><code>$ kubectl apply -f kube-flannel.yml
namespace/kube-flannel created
serviceaccount/flannel created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
configmap/kube-flannel-cfg created
daemonset.apps/kube-flannel-ds created
</code></pre><p>ãƒãƒ¼ãƒ‰ã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã¨ã€å…¨ãƒãƒ¼ãƒ‰ãŒReadyã«ãªã£ã¦ã„ã‚‹ã€‚</p><pre tabindex=0><code>$ kubectl get nodes
NAME        STATUS   ROLES           AGE   VERSION
thistle-0   Ready    control-plane   25m   v1.32.3
thistle-1   Ready    &lt;none&gt;          23m   v1.32.3
thistle-2   Ready    &lt;none&gt;          23m   v1.32.3
</code></pre><p>3å¹´å‰ã‚ã‚“ã ã‘è©°ã¾ã£ãŸã®ã¯ä¸€ä½“ãªã‚“ã ã£ãŸã‚“ã ã‚ã†ã€‚</p><h2 id=corednsãŒä¸ŠãŒã£ã¦ã“ãªã„>CoreDNSãŒä¸ŠãŒã£ã¦ã“ãªã„</h2><p>Podã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã¨CoreDNSãŒèµ·å‹•ã—ã¦ã„ãªã„ã€‚</p><pre tabindex=0><code>$ kubectl -n kube-system get pods
NAME                                READY   STATUS              RESTARTS   AGE
coredns-86c5fccbb-2css6             0/1     ContainerCreating   1          6h13m
coredns-86c5fccbb-ztp94             0/1     ContainerCreating   1          6h13m
etcd-thistle-0                      1/1     Running             3          6h20m
kube-apiserver-thistle-0            1/1     Running             3          6h20m
kube-controller-manager-thistle-0   1/1     Running             3          6h20m
kube-proxy-ctmwg                    1/1     Running             2          6h19m
kube-proxy-jzcqj                    1/1     Running             2          6h19m
kube-proxy-rc25q                    1/1     Running             2          6h20m
kube-scheduler-thistle-0            1/1     Running             3          6h21m
</code></pre><p>describeã§podã®çŠ¶æ…‹ã‚’è¦‹ã¦ã¿ã‚‹ã€‚</p><pre tabindex=0><code>$ kubectl -n kube-system describe pods coredns-86c5fccbb-2css6
Name:                 coredns-86c5fccbb-2css6
Namespace:            kube-system
Priority:             2000000000
Priority Class Name:  system-cluster-critical
Service Account:      coredns
Node:                 thistle-0/192.168.39.20
Start Time:           Tue, 25 Mar 2025 04:58:34 +0900
Labels:               k8s-app=kube-dns
                      pod-template-hash=86c5fccbb
Annotations:          kubectl.kubernetes.io/restartedAt: 2025-03-25T04:58:33+09:00
Status:               Running
IP:
IPs:                  &lt;none&gt;
Controlled By:        ReplicaSet/coredns-86c5fccbb
Containers:
  coredns:
    Container ID:
    Image:         registry.k8s.io/coredns/coredns:v1.11.3
    Image ID:
    Ports:         53/UDP, 53/TCP, 9153/TCP
    Host Ports:    0/UDP, 0/TCP, 0/TCP
    Args:
      -conf
      /etc/coredns/Corefile
    State:          Waiting
      Reason:       ContainerCreating
    Last State:     Terminated
      Reason:       ContainerStatusUnknown
      Message:      The container could not be located when the pod was deleted.  The container used to be Running
      Exit Code:    137
      Started:      Mon, 01 Jan 0001 00:00:00 +0000
      Finished:     Mon, 01 Jan 0001 00:00:00 +0000
    Ready:          False
    Restart Count:  1
    Limits:
      memory:  170Mi
    Requests:
      cpu:        100m
      memory:     70Mi
    Liveness:     http-get http://:8080/health delay=60s timeout=5s period=10s #success=1 #failure=5
    Readiness:    http-get http://:8181/ready delay=0s timeout=1s period=10s #success=1 #failure=3
    Environment:  &lt;none&gt;
    Mounts:
      /etc/coredns from config-volume (ro)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-6whk9 (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   False
  Initialized                 True
  Ready                       False
  ContainersReady             False
  PodScheduled                True
Volumes:
  config-volume:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      coredns
    Optional:  false
  kube-api-access-6whk9:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       &lt;nil&gt;
    DownwardAPI:             true
QoS Class:                   Burstable
Node-Selectors:              kubernetes.io/os=linux
Tolerations:                 CriticalAddonsOnly op=Exists
                             node-role.kubernetes.io/control-plane:NoSchedule
                             node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason                  Age                     From     Message
  ----     ------                  ----                    ----     -------
  Warning  FailedCreatePodSandBox  9m54s (x281 over 5h5m)  kubelet  (combined from similar events): Failed to create pod sandbox: rpc error: code = Unknown desc = failed to create pod network sandbox k8s_coredns-86c5fccbb-2css6_kube-system_632c1b51-bec4-4935-a93f-d1191f76e6d6_0(935b3ad214394f5d3730b1c1a4f7cbe261dd29a0e5cce8ebcc3eaf945ec7eba8): error adding pod kube-system_coredns-86c5fccbb-2css6 to CNI network &#34;cilium&#34;: plugin type=&#34;cilium-cni&#34; failed (add): unable to connect to Cilium agent: failed to create cilium agent client after 30.000000 seconds timeout: Get &#34;http://localhost/v1/config&#34;: dial unix /var/run/cilium/cilium.sock: connect: no such file or directory
Is the agent running?
  Warning  FailedCreatePodSandBox  3m8s  kubelet  Failed to create pod sandbox: rpc error: code = Unknown desc = failed to create pod network sandbox k8s_coredns-86c5fccbb-2css6_kube-system_632c1b51-bec4-4935-a93f-d1191f76e6d6_0(888b9d00c92b667b0e0b6d865ba9b96ff0e1afcee33acc2818e00d5f6ee5d64f): error adding pod kube-system_coredns-86c5fccbb-2css6 to CNI network &#34;cilium&#34;: plugin type=&#34;cilium-cni&#34; failed (add): unable to connect to Cilium agent: failed to create cilium agent client after 30.000000 seconds timeout: Get &#34;http://localhost/v1/config&#34;: dial unix /var/run/cilium/cilium.sock: connect: no such file or directory
Is the agent running?
  Warning  FailedCreatePodSandBox  2m4s  kubelet  Failed to create pod sandbox: rpc error: code = Unknown desc = failed to create pod network sandbox k8s_coredns-86c5fccbb-2css6_kube-system_632c1b51-bec4-4935-a93f-d1191f76e6d6_0(345a1307bba81a94435d8aff9a3d79c67fca3683ad66284d475805c371a4b38c): error adding pod kube-system_coredns-86c5fccbb-2css6 to CNI network &#34;cilium&#34;: plugin type=&#34;cilium-cni&#34; failed (add): unable to connect to Cilium agent: failed to create cilium agent client after 30.000000 seconds timeout: Get &#34;http://localhost/v1/config&#34;: dial unix /var/run/cilium/cilium.sock: connect: no such file or directory
Is the agent running?
  Warning  FailedCreatePodSandBox  63s  kubelet  Failed to create pod sandbox: rpc error: code = Unknown desc = failed to create pod network sandbox k8s_coredns-86c5fccbb-2css6_kube-system_632c1b51-bec4-4935-a93f-d1191f76e6d6_0(2e436ec645ce0fac36945db53eaaee27b1d89680484749ad6e2d72c9371f77c1): error adding pod kube-system_coredns-86c5fccbb-2css6 to CNI network &#34;cilium&#34;: plugin type=&#34;cilium-cni&#34; failed (add): unable to connect to Cilium agent: failed to create cilium agent client after 30.000000 seconds timeout: Get &#34;http://localhost/v1/config&#34;: dial unix /var/run/cilium/cilium.sock: connect: no such file or directory
Is the agent running?
  Warning  FailedCreatePodSandBox  2s  kubelet  Failed to create pod sandbox: rpc error: code = Unknown desc = failed to create pod network sandbox k8s_coredns-86c5fccbb-2css6_kube-system_632c1b51-bec4-4935-a93f-d1191f76e6d6_0(4184bee28309b45aa260c25d2a92f68d6dbac4399ae028b465212cc4a25219ae): error adding pod kube-system_coredns-86c5fccbb-2css6 to CNI network &#34;cilium&#34;: plugin type=&#34;cilium-cni&#34; failed (add): unable to connect to Cilium agent: failed to create cilium agent client after 30.000000 seconds timeout: Get &#34;http://localhost/v1/config&#34;: dial unix /var/run/cilium/cilium.sock: connect: no such file or directory
Is the agent running?
</code></pre><p>Eventsã‚’è¦‹ã‚‹ã¨ã€ã©ã†ã‚„ã‚‰Ciliumã‚’ä½¿ãŠã†ã¨ã—ã¦å¤±æ•—ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚Ciliumã¯æ—¢ã«ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã®ã§å½“ç„¶ä½¿ãˆãªã„ãŒã€ãªãœãã‚‚ãã‚‚ä½¿ãŠã†ã¨ã—ã¦ã—ã¾ã†ã®ã‹ï¼Ÿ</p><p>ã¨ã„ã†ã‚ã‘ã§èª¿ã¹ã¦ã¿ã‚‹ã¨åŒã˜äº‹è±¡ã®è¨˜äº‹ãŒã‚ã£ãŸ: <a href=https://qiita.com/ishii1648/items/f0b9882834d63534461e>kubernetesã§corednsãŒèµ·å‹•ã—ãªã„æ™‚ã«ç¢ºèªã™ã‚‹ã“ã¨ #Calico - Qiita</a></p><p><code>/etc/cni/net.d</code>ä»¥ä¸‹ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãã†ãªã®ã§ã€æ¢ã—ã¦ã¿ã‚‹ã€‚</p><pre tabindex=0><code>$ cat /etc/cni/net.d/
05-cilium.conflist                10-flannel.conflist
10-crio-bridge.conflist.disabled  .kubernetes-cni-keep
$
</code></pre><p><code>05-cilium.conflist</code>ãŒã‚ã‚‹ã€‚ã“ã‚Œã‚’å‰Šé™¤ã—ã¦ã—ã°ã‚‰ãã™ã‚‹ã¨ã€Runningã«ãªã£ãŸã€‚</p><pre tabindex=0><code>$ sudo rm /etc/cni/net.d/05-cilium.conflist
$ kubectl -n kube-system get pods
NAME                                READY   STATUS              RESTARTS   AGE
coredns-86c5fccbb-2css6             1/1     Running             2          6h26m
coredns-86c5fccbb-q226s             0/1     ContainerCreating   0          10m
etcd-thistle-0                      1/1     Running             4          6h33m
kube-apiserver-thistle-0            1/1     Running             4          6h33m
kube-controller-manager-thistle-0   1/1     Running             4          6h33m
kube-proxy-ctmwg                    1/1     Running             2          6h31m
kube-proxy-jzcqj                    1/1     Running             2          6h31m
kube-proxy-rc25q                    1/1     Running             3          6h33m
kube-scheduler-thistle-0            1/1     Running             4          6h33m
</code></pre><p>å„ãƒãƒ¼ãƒ‰ã«<code>05-cilium.conflist</code>ãŒã‚ã£ãŸãŸã‚ã€ä»–ã®ãƒãƒ¼ãƒ‰ã§ã‚‚åŒæ§˜ã«å‰Šé™¤ã™ã‚‹ã¨ã€æ®‹ã£ã¦ã„ã‚‹ContainerCreatingã®ã‚‚ã®ã‚‚æ­£å¸¸åŒ–ã—ãŸã€‚</p><p>ã¨ã„ã†ã‚ã‘ã§k8sã‚¯ãƒ©ã‚¹ã‚¿ã®æ§‹ç¯‰ãŒå®Œäº†ã—ãŸã€‚æœ¬å½“ã«3å¹´å‰ã®apiserverç„¡é™å†èµ·å‹•ã¯ä½•ã ã£ãŸã‚“ã ã‚ã†ã­ã€‚</p></div></div></div><script src=https://aquarite.info/js/ui.js></script><script src=https://aquarite.info/js/menus.js></script><script data-goatcounter=https://aquarite.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>
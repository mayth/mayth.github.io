<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>C# on Hello, (forgotten) world ☂</title><link>https://aquarite.info/tags/c%23/</link><description>Recent content in C# on Hello, (forgotten) world ☂</description><generator>Hugo</generator><language>ja-jp</language><copyright>&amp;copy; 2021 Mei Akizuru. All rights reserved.</copyright><lastBuildDate>Wed, 07 May 2014 13:33:03 +0900</lastBuildDate><atom:link href="https://aquarite.info/tags/c%23/index.xml" rel="self" type="application/rss+xml"/><item><title>MonoのWebClientにおけるURI</title><link>https://aquarite.info/blog/2014/05/uri-parsing-in-webclient/</link><pubDate>Wed, 07 May 2014 13:33:03 +0900</pubDate><guid>https://aquarite.info/blog/2014/05/uri-parsing-in-webclient/</guid><description>&lt;h1 id="発端"&gt;発端&lt;/h1&gt;
&lt;p&gt;発端は&lt;a href="https://aquarite.info/blog/2014/05/07/tkbctf3-miocat/"&gt;前の記事&lt;/a&gt;にあるように、tkbctf3の問題としてmiocatなるものを出してみたのはいいものの、意図とは異なる脆弱性を作り込んで250点問題が超絶ボーナス問題になりましたよ、というお話しです。&lt;/p&gt;
&lt;h1 id="調査"&gt;調査&lt;/h1&gt;
&lt;p&gt;miocatはC#で書かれており、実際の運用ではMonoランタイムで動いていました。というわけでMonoのソースコードを読めば解決です。やったね。&lt;/p&gt;
&lt;p&gt;そういうわけでまずは&lt;code&gt;WebClient&lt;/code&gt;の実装を読んでみたのですが、怪しい箇所が一発で見つかりました。&lt;a href="https://github.com/mono/mono/blob/2d573ae1ceac1656f0293cca3736dcb10c28be38/mcs/class/System/System.Net/WebClient.cs#L798"&gt;WebClient.cs#798&lt;/a&gt;、privateメソッドである&lt;code&gt;CreateUri(string)&lt;/code&gt;なるメソッドです。&lt;code&gt;DownloadString(string)&lt;/code&gt;は、その引数をこのメソッドに渡して&lt;code&gt;DownloadData(Uri)&lt;/code&gt;を呼び出します。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;try-catch&lt;/code&gt;の中で渡されたアドレス（と、&lt;code&gt;baseAddress&lt;/code&gt;）を元に&lt;code&gt;Uri&lt;/code&gt;のインスタンスを作って&lt;code&gt;CreateUri(Uri)&lt;/code&gt;に渡していますが、ここで例外が発生すると&lt;code&gt;return new Uri(Path.GetFullPath(address))&lt;/code&gt;という恐怖のコードが走ります。&lt;/p&gt;</description></item></channel></rss>